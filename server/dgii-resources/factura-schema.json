{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Schema de Validación para DTE - Factura Electrónica",
  "type": "object",
  "required": ["version", "ambiente", "tipoDte", "numeroControl", "codigoGeneracion", "tipoModelo", "tipoOperacion", "fecEmi", "horEmi", "emisor", "receptor", "cuerpoDocumento", "resumen"],
  "properties": {
    "version": {
      "type": "number",
      "enum": [1],
      "description": "Versión del schema"
    },
    "ambiente": {
      "type": "string",
      "enum": ["00", "01"],
      "description": "00=Pruebas, 01=Producción"
    },
    "tipoDte": {
      "type": "string",
      "enum": ["01", "03", "05", "06", "07", "08", "09", "11", "14", "15"],
      "description": "Tipo de Documento Tributario Electrónico"
    },
    "numeroControl": {
      "type": "string",
      "pattern": "^[0-9]{3}-[0-9]{18}$",
      "description": "Número de Control: 3 dígitos - 18 dígitos"
    },
    "codigoGeneracion": {
      "type": "string",
      "pattern": "^[A-Fa-f0-9]{8}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{12}$",
      "description": "UUID v4 para identificación única del DTE"
    },
    "tipoModelo": {
      "type": "string",
      "enum": ["1", "2"],
      "description": "1=Modelo de Factura Completa, 2=Modelo sin detalles"
    },
    "tipoOperacion": {
      "type": "string",
      "enum": ["1", "2"],
      "description": "1=DTE por servicios/bienes, 2=Exportación"
    },
    "fecEmi": {
      "type": "string",
      "pattern": "^\\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\\d|3[01])$",
      "description": "Fecha de emisión (YYYY-MM-DD)"
    },
    "horEmi": {
      "type": "string",
      "pattern": "^([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d$",
      "description": "Hora de emisión (HH:MM:SS)"
    },
    "tipoMoneda": {
      "type": "string",
      "default": "USD",
      "description": "Tipo de moneda (por defecto USD)"
    },
    "emisor": {
      "type": "object",
      "required": ["nit", "nrc", "nombre", "codActividad", "descActividad", "tipoEstablecimiento"],
      "properties": {
        "nit": {
          "type": "string",
          "pattern": "^[0-9]{14}-[0-9]$",
          "description": "NIT del emisor (14 dígitos - verificador)"
        },
        "nrc": {
          "type": "string",
          "pattern": "^[0-9]{1,6}$",
          "description": "NRC del emisor"
        },
        "nombre": {
          "type": "string",
          "maxLength": 100,
          "description": "Razón social del emisor"
        },
        "codActividad": {
          "type": "string",
          "description": "Código de actividad ISIC"
        },
        "descActividad": {
          "type": "string",
          "maxLength": 150,
          "description": "Descripción de la actividad"
        },
        "tipoEstablecimiento": {
          "type": "string",
          "enum": ["01", "02", "03"],
          "description": "01=Matriz, 02=Sucursal, 03=Agencia"
        },
        "direccion": {
          "type": "object",
          "required": ["departamento", "municipio", "complemento"],
          "properties": {
            "departamento": {
              "type": "string",
              "pattern": "^(0[1-9]|1[0-4])$",
              "description": "Código de departamento (01-14)"
            },
            "municipio": {
              "type": "string",
              "description": "Código de municipio"
            },
            "complemento": {
              "type": "string",
              "maxLength": 200,
              "description": "Dirección detallada"
            }
          }
        },
        "telefono": {
          "type": "string",
          "pattern": "^[0-9]{8}$",
          "description": "Teléfono (8 dígitos)"
        },
        "correo": {
          "type": "string",
          "format": "email",
          "description": "Correo electrónico"
        }
      }
    },
    "receptor": {
      "type": "object",
      "required": ["tipoDocumento", "numDocumento", "nombre"],
      "properties": {
        "tipoDocumento": {
          "type": "string",
          "enum": ["36", "13", "02", "03", "37"],
          "description": "36=NIT, 13=DUI, 02=Carnet Residente, 03=Pasaporte, 37=Otro"
        },
        "numDocumento": {
          "type": "string",
          "description": "Número del documento"
        },
        "nombre": {
          "type": "string",
          "maxLength": 100,
          "description": "Nombre o razón social del receptor"
        },
        "direccion": {
          "type": "object",
          "required": ["departamento", "municipio", "complemento"],
          "properties": {
            "departamento": {
              "type": "string",
              "pattern": "^(0[1-9]|1[0-4])$"
            },
            "municipio": {
              "type": "string"
            },
            "complemento": {
              "type": "string",
              "maxLength": 200
            }
          }
        }
      }
    },
    "cuerpoDocumento": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["numItem", "tipoItem", "cantidad", "descripcion", "precioUni", "ventaGravada"],
        "properties": {
          "numItem": {
            "type": "integer",
            "minimum": 1,
            "description": "Número secuencial del item"
          },
          "tipoItem": {
            "type": "string",
            "enum": ["1", "2", "3", "4"],
            "description": "1=Bienes, 2=Servicios, 3=Ambos, 4=Otro"
          },
          "cantidad": {
            "type": "number",
            "minimum": 0.01,
            "description": "Cantidad de unidades"
          },
          "descripcion": {
            "type": "string",
            "maxLength": 150,
            "description": "Descripción del bien o servicio"
          },
          "precioUni": {
            "type": "number",
            "minimum": 0,
            "description": "Precio unitario"
          },
          "ventaGravada": {
            "type": "number",
            "minimum": 0,
            "description": "Venta gravada (sujeta a IVA)"
          },
          "ventaExenta": {
            "type": "number",
            "default": 0,
            "description": "Venta exenta de IVA"
          },
          "ventaNoSuj": {
            "type": "number",
            "default": 0,
            "description": "Venta no sujeta"
          }
        }
      }
    },
    "resumen": {
      "type": "object",
      "required": ["totalGravada", "totalIva", "totalPagar"],
      "properties": {
        "totalNoSuj": {
          "type": "number",
          "default": 0
        },
        "totalExenta": {
          "type": "number",
          "default": 0
        },
        "totalGravada": {
          "type": "number",
          "minimum": 0
        },
        "totalIva": {
          "type": "number",
          "minimum": 0,
          "description": "IVA al 13%"
        },
        "totalPagar": {
          "type": "number",
          "minimum": 0,
          "description": "Total a pagar (gravada + IVA)"
        },
        "totalLetras": {
          "type": "string",
          "description": "Monto en letras"
        },
        "condicionOperacion": {
          "type": "string",
          "enum": ["1", "2", "3"],
          "default": "1",
          "description": "1=Contado, 2=Crédito, 3=Otro"
        }
      }
    }
  }
}
